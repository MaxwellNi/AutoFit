# Column Manifest Audit Anchor (20260129_073037)

Public audit anchor for column-level sufficiency: MUST_KEEP / CAN_DROP / SHOULD_ADD / MUST_ADD_TABLE. Host names: **3090**, **4090** only. No local absolute paths; repro commands below.

## MUST_KEEP (outcome + trajectory)

- **Columns:** entity_id, platform_name, offer_id, snapshot_ts, funding_goal_usd, funding_raised_usd, investors_count, is_funded
- **Rationale:** Entity keys, time axis, and numerics required by `scripts/run_full_benchmark.py` for label construction and time-series features. Parsed from code; missing any => gate FAIL.

## CAN_DROP

- **Columns:** hash_id, link (and unused identifiers/URLs or heavy arrays in core)
- **Rationale:** Unused identifiers/URLs in core; safe to drop for modeling.

## SHOULD_ADD (next version v3)

- **Columns:** Only listed when missingness < 80% in raw and has variance. Candidates: number_of_days_left, status, web_fundraising_status, offering_status, interest_rate, valuation_*_usd, ticket_amount_*_usd, price_*_usd.
- **Rationale:** Next version (v3) if added; audit only marks when raw has sufficient coverage.

## MUST_ADD_TABLE

- **Table:** offers_text (for NBI/NCI narrative concepts)
- **Rationale:** Narrative columns (headline, title, description_text, company_description, product_description, financial_condition, financial_forecasts, financial_risks, offering_purpose, use_of_funds, reasons_to_invest, updates, questions, term_sheet, front_video_transcript) belong to offers_text table, NOT offers_core.

## EDGAR value-level recompute (hard gate)

- Recompute 27 aggregated features from raw EDGAR accessions aligned to snapshot dates (same logic as `align_edgar_features_to_snapshots`). Compare recomputed vs store with atol. If recompute cannot be performed or diff exceeds tolerance when `--require_deltalake 1` => gate FAIL.

## Gate rules

- `--require_deltalake 1` and deltalake missing or any raw scan skipped => FAIL (exit 2).
- Any MUST_KEEP missing in offers_core => FAIL.
- `--text_required_mode 1` and offers_text table missing => FAIL.
- EDGAR recompute check fails => FAIL.

## Reproducibility

**On 3090** (log: `column_manifest_3090.log`):

```bash
HOST_TAG=3090 conda run -n insider python scripts/audit_column_manifest.py \
  --offers_core runs/offers_core_v2_20260127_043052/offers_core.parquet \
  --offers_static runs/offers_core_v2_20260127_043052/offers_static.parquet \
  --edgar_dir runs/edgar_feature_store/20260127_133511/edgar_features \
  --raw_offers_delta data/raw/offers \
  --raw_edgar_delta data/raw/edgar/accessions \
  --selection_json runs/selections/b11_v2_canonical/sampled_entities.json \
  --output_dir runs/orchestrator/20260129_073037/analysis \
  --seed 42 --sample_entities 1000 --edgar_recompute_pairs 10 \
  --require_deltalake 1 --text_required_mode 0 \
  2>&1 | tee runs/orchestrator/20260129_073037/analysis/logs/column_manifest_3090.log
```

**On 4090** (log: `column_manifest_4090.log`):

```bash
HOST_TAG=4090 conda run -n insider python scripts/audit_column_manifest.py \
  --offers_core runs/offers_core_v2_20260127_043052/offers_core.parquet \
  --offers_static runs/offers_core_v2_20260127_043052/offers_static.parquet \
  --edgar_dir runs/edgar_feature_store/20260127_133511/edgar_features \
  --raw_offers_delta data/raw/offers \
  --raw_edgar_delta data/raw/edgar/accessions \
  --selection_json runs/selections/b11_v2_canonical/sampled_entities.json \
  --output_dir runs/orchestrator/20260129_073037/analysis \
  --seed 42 --sample_entities 1000 --edgar_recompute_pairs 10 \
  --require_deltalake 1 --text_required_mode 0 \
  2>&1 | tee runs/orchestrator/20260129_073037/analysis/logs/column_manifest_4090.log
```

Outputs (local, untracked): `column_manifest.json`, `column_manifest.md`, `logs/column_manifest_{HOST_TAG}.log` under `output_dir`.
