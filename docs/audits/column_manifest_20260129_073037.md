# Column Manifest Audit Anchor (20260129_073037)

Public audit anchor for column-level sufficiency: MUST_KEEP / CAN_DROP / SHOULD_ADD / MUST_ADD_TABLE. Host names: **3090**, **4090** only. No local absolute paths; repro commands below.

**SEAL requirement:** `--text_required_mode 1` must PASS on both 3090 and 4090. Build offers_text first, then run audit with `--offers_text` and `--text_required_mode 1`.

## MUST_KEEP (outcome + trajectory)

- **offers_core:** entity_id, platform_name, offer_id, snapshot_ts, funding_goal_usd, funding_raised_usd, investors_count, is_funded
- **Rationale:** Entity keys, time axis, and numerics required by `scripts/run_full_benchmark.py` for label construction and time-series features. Missing any => gate FAIL.

## CAN_DROP

- **Columns:** hash_id, link (unused identifiers/URLs in core)
- **Rationale:** Safe to drop for modeling; only remove in v3 rebuild.

## offers_text.must_keep (NBI/NCI)

- **Columns:** entity_id, platform_name, offer_id, snapshot_ts, headline, title, description_text, company_description, product_description, financial_condition, financial_forecasts, financial_risks, offering_purpose, term_sheet, front_video_transcript, use_of_funds_text, reasons_to_invest_text, updates_text, questions_text
- **Rationale:** Narrative columns for NBI/NCI concept bottleneck; belong to offers_text table, NOT offers_core. Array fields (use_of_funds, reasons_to_invest, updates, questions) converted to _text (newline-joined strings).

## EDGAR value-level recompute (hard gate)

- Recompute 27 aggregated features from raw EDGAR aligned to snapshot dates. Compare recomputed vs store with atol. total_compared must be >= --edgar_min_compared (default 10). If recompute skipped or diff exceeds tolerance when `--require_deltalake 1` => FAIL.

## Gate rules

- `--require_deltalake 1` and deltalake missing or raw scan skipped => FAIL.
- Any MUST_KEEP missing in offers_core => FAIL.
- `--text_required_mode 1` and offers_text missing or missing contract columns => FAIL.
- EDGAR recompute total_compared < edgar_min_compared => FAIL.

## Reproducibility

**Step 1 — Build offers_text (3090 or 4090):**

```bash
HOST_TAG=3090 conda run -n insider python scripts/build_offers_text.py \
  --raw_offers_delta data/raw/offers \
  --output_dir runs/offers_text_v1_20260129_073037 \
  2>&1 | tee runs/orchestrator/20260129_073037/analysis/logs/build_offers_text_3090.log
```

(Omit `--limit_rows` for full build; use `--limit_rows 1000000` for faster test.)

**Step 2 — Column manifest audit with text_required_mode=1 (3090):**

```bash
HOST_TAG=3090 conda run -n insider python scripts/audit_column_manifest.py \
  --offers_core runs/offers_core_v2_20260127_043052/offers_core.parquet \
  --offers_static runs/offers_core_v2_20260127_043052/offers_static.parquet \
  --offers_text runs/offers_text_v1_20260129_073037/offers_text.parquet \
  --edgar_dir runs/edgar_feature_store/20260127_133511/edgar_features \
  --raw_offers_delta data/raw/offers \
  --raw_edgar_delta data/raw/edgar/accessions \
  --selection_json runs/selections/b11_v2_canonical/sampled_entities.json \
  --output_dir runs/orchestrator/20260129_073037/analysis \
  --seed 42 --sample_entities 1000 --edgar_recompute_pairs 10 \
  --require_deltalake 1 --text_required_mode 1 \
  2>&1 | tee runs/orchestrator/20260129_073037/analysis/logs/column_manifest_3090_textreq.log
```

**On 4090:** Same commands with `HOST_TAG=4090` and log `column_manifest_4090_textreq.log`. Use `conda activate insider` before running if needed.

Outputs (local, untracked): `column_manifest.json`, `column_manifest.md`, `logs/column_manifest_{HOST_TAG}.log`, `logs/build_offers_text_{HOST_TAG}.log` under analysis dir.
