# Audit Anchor: orchestrator_20260129_073037

- stamp: 20260129_073037
- git_head: d9275a2067eeb5a37b1d1d9fd1282ec7b1398c5d
- offers_core: runs/offers_core_v2_20260127_043052/offers_core.parquet
- offers_core_sha256: 43029f8369c2b57e5eb470dfc7b2854ed437bcaf14383fcc8b8f872e471fbd34
- selection_hash: 8cc078efff1abfaad304625a8f77fb424b2618a46bcddf162953e22fff2ac1a5
- edgar_col_hash: 6b540c7bb14edeef609ae3c646bb7ac0a967e58b68360a8d766c5c6da650e2c8
- edgar_delta_versions: {'edgar_accessions_version': 1639, 'offers_snapshots_version': 86604}

## Source Artifacts
- runs/orchestrator/20260129_073037/SUMMARY.md
- runs/orchestrator/20260129_073037/MANIFEST_full.json

## Paper Tables (TeX)
- runs/orchestrator/20260129_073037/paper_tables/tables/main_results.tex
- runs/orchestrator/20260129_073037/paper_tables/tables/ablation.tex
- runs/orchestrator/20260129_073037/paper_tables/tables/efficiency.tex
- runs/orchestrator/20260129_073037/paper_tables/tables/faithfulness.tex

## Paper Tables Check
- rebuild command used include_prefix:
  - b11_v2_edgar_off_h14_sf0_20260129_073037
  - b11_v2_edgar_on_h14_sf0_20260129_073037
  - b11_v2_edgar_off_h14_sf1_20260129_073037
  - b11_v2_edgar_on_h14_sf1_20260129_073037
  - b11_v2_edgar_off_h30_sf0_20260129_073037
  - b11_v2_edgar_on_h30_sf0_20260129_073037
  - b11_v2_edgar_off_h30_sf1_20260129_073037
  - b11_v2_edgar_on_h30_sf1_20260129_073037
  - b11_v2_edgar_off_h45_sf0_20260129_073037
  - b11_v2_edgar_on_h45_sf0_20260129_073037
  - b11_v2_edgar_off_h45_sf1_20260129_073037
  - b11_v2_edgar_on_h45_sf1_20260129_073037
- spot check: `paper_tables/main_results.csv` rows only show stamp `20260129_073037`
- note: `paper_tables/ablation.csv` is empty (no edgar on/off pairs within a single exp_name)

## Comparability
- report: `runs/orchestrator/20260129_073037/analysis/comparability_report.md`
- outcome:
  - full 12-run factor coverage (horizon × strict_future × use_edgar)
  - non-factor hyperparameters consistent across runs
  - label stats and split counts match between edgar_on/off pairs (no scale or subset drift)
  - edgar join coverage is low (overall ~0.0029) with no implicit filtering detected
  - RMSE differences (e.g., ~334 vs ~1e4) are not explained by label scale/filters; likely model/metric behavior on identical label distributions (see report for rmse_over_test_std table)

## Finalization
- comparability commit head: 6cfa0cfb8fe206096572cb3d7255fda37ec1a847
- bundle: runs/backups/repo_root_20260129_113848_comparability.bundle

---

## BLOCK 3 READY

### Current benchmark data morphology
- **offers_core_v2:** Entity subset full trajectory (`limit_entities=5000` from MANIFEST; `selection.limit_entities`)
- **offers_text_full:** Full raw scan filtered/deduped text panel (manifest counters: `raw_rows_scanned`, `rows_emitted`, `limit_rows=null` prove full build)
- **edgar_store:** Full raw aggregation aligned to snapshots (`edgar_accessions_version` + `offers_snapshots_version` in MANIFEST)

### Full-scale roadmap (BLOCK 3.5)
- Refactor `build_offers_core` to streaming + partitioned write (parquet/delta) to avoid `to_table()` full load
- Use `deltalake.write_deltalake` with partitioning or PyArrow streaming scanner + chunked writes

### Gate status (3090 / 4090)
- **BLOCK 1.5+++:** column_manifest audit PASS (text_required_mode=1, full offers_text)
- **BLOCK 2:** benchmark_truthfulness + make_paper_tables_v2 PASS
- **raw_cardinality_coverage:** PASS (raw versions/active_files consistent across hosts)

Logs:
- `runs/orchestrator/20260129_073037/analysis/logs/column_manifest_full_{3090|4090}.log`
- `runs/orchestrator/20260129_073037/analysis/logs/benchmark_truthfulness_{3090|4090}.log`
- `runs/orchestrator/20260129_073037/analysis/logs/raw_cardinality_coverage_{3090|4090}.log`

### Build offers_text_full (full-scale, maximize RAM)

Chunk size auto-tuned from RAM, **capped at 25M** (raw offers ~105M rows; must process during scan). Output passes Block 1.5+++/Block 2 audits; feeds Block 3.

**Full build on 4090 (or any host):**

```bash
mkdir -p runs/orchestrator/20260129_073037/analysis/logs
PYTHONUNBUFFERED=1 python scripts/build_offers_text.py \
  --raw_offers_delta data/raw/offers \
  --output_dir runs/offers_text_v1_20260129_073037_full \
  --overwrite 1 \
  2>&1 | tee runs/orchestrator/20260129_073037/analysis/logs/build_offers_text_full_$(hostname -s).log
```

Output: `runs/offers_text_v1_20260129_073037_full/offers_text.parquet`, `MANIFEST.json`

Post-build: run column_manifest audit with `--offers_text runs/offers_text_v1_20260129_073037_full/offers_text.parquet` and `--text_required_mode 1`.

---

## FULL-SCALE READY (offers_core_full_daily + edgar_store_full_daily + offers_text_full)

### Data semantics
| Artifact | Granularity | Join keys | MANIFEST |
|----------|-------------|-----------|----------|
| **offers_core_full_daily** | (entity_id, snapshot_ts_day) trajectory | entity_id, platform_name, offer_id | `runs/offers_core_full_daily_${FULL_STAMP}/MANIFEST.json` |
| **edgar_store_full_daily** | (platform_name, offer_id, cik, snapshot_ts) aligned | platform_name, offer_id, cik | `runs/edgar_feature_store_full_daily_${FULL_STAMP}/MANIFEST.json` |
| **offers_text_full** | (entity_id, snapshot_ts) text panel | entity_id | `runs/offers_text_v1_20260129_073037_full/MANIFEST.json` |

### Build order
1. `build_offers_core_daily_full.py` → offers_core_daily.parquet, offers_static.parquet
2. `make_snapshots_index_from_offers_core.py` → snapshots_cik_day.parquet
3. `build_edgar_features.py --snapshots_index_parquet ...` → edgar_features/
4. Audits: column_manifest, raw_cardinality_coverage, benchmark_truthfulness

### Stamp
```bash
export FULL_STAMP=$(date +%Y%m%d_%H%M%S)
```
